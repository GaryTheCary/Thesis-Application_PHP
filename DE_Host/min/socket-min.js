function emitDatatoFrontEnd(e){io.on("connection",function(){io.emit("data",msg)})}function writeSynFile(e,r){fs.exists(e,function(o){if(o){console.log("yes, the file is here");var n=fs.createWriteStream(e,{flags:"a+"}),t=tsv({seperator:"	",sendHeaders:!1});t.pipe(n),t.write(r),t.end()}else die("the file does not exist at all, please check")})}function updateRepeatFile(e,r){}function dateString(){var e=new Date,r=Number(e.getFullYear().toString().substr(2,2)),o=e.getShortMonthName(),n=e.getDate(),t=e.getHours(),s=r+"-"+o+"-"+n+"-"+t;return s}function CoP(e){var r=Math.round((e.SensorOne*sensorCordinate.SensorOne.x+e.SensorTwo*sensorCordinate.SensorTwo.x+e.SensorThree*sensorCordinate.SensorThree.x+e.SensorFour*sensorCordinate.SensorFour.x+e.SensorFive*sensorCordinate.SensorFive.x)/(e.SensorOne+e.SensorTwo+e.SensorThree+e.SensorFour+e.SensorFive)),o=Math.round((e.SensorOne*sensorCordinate.SensorOne.y+e.SensorTwo*sensorCordinate.SensorTwo.y+e.SensorThree*sensorCordinate.SensorThree.y+e.SensorFour*sensorCordinate.SensorFour.y+e.SensorFive*sensorCordinate.SensorFive.y)/(e.SensorOne+e.SensorTwo+e.SensorThree+e.SensorFour+e.SensorFive)),n,t=new Date;o>=0&&60>=o&&(n=1),o>60&&120>=o&&(n=2),o>120&&(n=3);var s={day:t.getDayIndex(),hour:t.getHours(),zone:n};writeSynFile("public/assets/data/copMap.tsv",s)}var app=require("express")(),bodyParser=require("body-parser"),server=require("http").Server(app),io=require("socket.io")(server),fs=require("fs"),path=require("path"),tsv=require("csv-write-stream"),Particle=require("particle-api-js");const PORT=3e3;var sensorData={},redis=require("ioredis"),Redis=new redis,mysql=require("mysql"),mysqlconnection=mysql.createConnection({host:"localhost",user:"homestead",password:"secret",database:"homestead"});mysqlconnection.connect(),io.on("connection",function(e){e="test",setInterval(function(){io.emit("data",e)},1e3)});var sensorCordinate={SensorOne:{x:30,y:140},SensorTwo:{x:60,y:130},SensorThree:{x:40,y:100},SensorFour:{x:60,y:90},SensorFive:{x:50,y:40}},die=function(e){console.log(e),process.exit(1)};Date.prototype.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],Date.prototype.dayIndex=[7,1,2,3,4,5,6],Date.prototype.getDayIndex=function(){return this.dayIndex[this.getDay()]},Date.prototype.getMonthName=function(){return this.monthNames[this.getMonth()]},Date.prototype.getShortMonthName=function(){return this.getMonthName().substr(0,3)},app.use(bodyParser.urlencoded({extended:!1})),app.use(bodyParser.json()),server.listen(PORT,function(){console.log("your are on board")});var particle=new Particle;particle.login({username:"xz14ld@student.ocadu.ca",password:"Rihanna7"}).then(function(e){console.log("API call completed on promise resolve: ",e.body.access_token)},function(e){console.log("API call completed on promise fail: ",e)}),particle.getEventStream({deviceId:"2b002d000347343138333038",name:"dataString",auth:"3d405a83ef06902a338842bc0f657e1644ce97ed"}).then(function(e){e.on("event",function(e){for(var r=e.data,o=r.split(" "),n=0;n<o.length;n++)o[n]=Number(o[n]);var t={date:dateString(),SensorOne:o[0],SensorTwo:o[1],SensorThree:o[2],SensorFour:o[3],SensorFive:o[4]};writeSynFile("public/assets/data/sensorData.tsv",t),CoP(t),writeSynFile("public/assets/data/sensorRear.tsv",{date:t.date,SensorOne:t.SensorOne,SensorTwo:t.SensorTwo}),writeSynFile("public/assets/data/sensorMiddle.tsv",{date:t.date,SensorThree:t.SensorThree,SensorFour:t.SensorFour}),writeSynFile("public/assets/data/sensorHinder.tsv",{date:t.date,SensorFive:t.SensorFive})})});